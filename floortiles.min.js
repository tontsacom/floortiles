/*
 FloorTiles v1.5 (https://github.com/tontsacom/floortiles)
 Copyright 2017
 Licensed under the MIT license
*/
(function(m){var q={tileSize:{x:200,y:150},tileLimit:{x:6,y:4},maxWidth:1E3,gap:3,minCol:2,maxCol:6,animate:!0,animateTime:500,delayResizeTime:500,tiled:function(b,a){},debug:!1},k=function(b,a){this.$element=m(b);var f=this.$element.children();0==f.length&&m.error("No tiles in jQuery.floortiles");f.eq(0).data("tile")||m.error("The tile size of the element 0 in jQuery.floortiles is not specified");for(var d=f.get(0).tagName,e=1;e<f.length;e++)f.eq(e).data("tile")||m.error("The tile size of the element "+
e+" in jQuery.floortiles is not specified"),f.get(e).tagName!=d&&m.error("Not the same tags in tiles in jQuery.floor");f.css({position:"absolute"});this.$element.wrapInner('<div class="floortiles-wrapper" style="position:relative;max-width:100%;margin:0 auto;" />');m.extend(this,q);this.nextStatus=!1;this.reset(a);this.nextStatus=!0};k.prototype.destructor=function(){this.$element.html(this.$element.children().html());this.$element.children().removeAttr("style")};k.prototype.reset=function(b){for(var a in b)if(a in
q)switch(a){case "tileSize":var f=this.minSize(b[a],"40x30");f||m.error("Wrong value "+b[a]+" of property "+a+" in jQuery.floortiles");this[a]=f;break;case "tileLimit":(f=this.size(b[a]))||m.error("Wrong value "+b[a]+" of property "+a+" in jQuery.floortiles");this[a]=f;break;default:this[a]=b[a]}else m.error("Undefined property "+a+" in jQuery.floortiles");this.refresh()};k.prototype.refresh=function(){"number"==typeof this.maxWidth?this.width=Math.min(this.$element.width(),this.maxWidth):"none"==
this.maxWidth?this.width=this.$element.width():m.error("Wrong value of property maxWidth in jQuery.floortiles");this.columns=Math.max(Math.min(Math.ceil((this.width+this.gap)/this.tileSize.x),this.maxCol),this.minCol);for(var b=this.$element.find(".floortiles-wrapper").children(),a={tiles:[],order:[],spaces:[],holes:[],poses:[]},f=[],d=[],e,c=0;c<b.length;c++){var h=this.minSizeTile(b.eq(c).data("tile"));a.tiles.push({x:h.x,y:h.y});a.order.push(c);a.poses.push({x:0,y:0,v:0})}this.debug&&(e=performance.now());
this.sitAll(a);for(c=b=0;0<a.holes.length&&100>b;b++){for(var h=a.order.findIndex(function(b){return b==a.holes[c].i}),g=1;c+g<a.holes.length&&a.holes[c+g].x==a.holes[c].x+g&&a.holes[c+g].y==a.holes[c].y;g++);for(;a.holes[c].x+g<this.columns&&!(a.spaces[a.holes[c].x+g].y>a.holes[c].y);g++);for(var l=h+1,k=0,n=0;l<a.order.length&&a.tiles[a.order[l]].x!=g;l++)a.tiles[a.order[l]].x<g&&k<a.tiles[a.order[l]].x&&(k=a.tiles[a.order[l]].x,n=l);l>=a.order.length&&(l=n);if(0<l){g=a.tiles[a.order[l]].x;f=a.order.slice(h,
l+1).sort(function(b,c){return a.tiles[b].x==g&&a.tiles[c].x==g||a.tiles[b].x!=g&&a.tiles[c].x!=g?b-c:a.tiles[b].x==g?-1:1});for(g=f.length;g--;)a.order[h+g]=f[g];f.length=0}else{l=a.holes[c].y;for(k=0;k<h;k++)f.push({i:a.order[k],y:a.poses[a.order[k]].y,y2:a.poses[a.order[k]].y+a.tiles[a.order[k]].y});for(n=f.filter(function(a){return a.y<=l&&a.y2>l}).sort(this.compareH);n[0].y<l;)l=n[0].y,n=f.filter(function(a){return a.y<=l&&a.y2>l}).sort(this.compareH);k=n[0].i;for(f.length=0;h--&&(a.tiles[a.order[h+
1]].x!=a.tiles[a.order[h]].x&&a.order.splice(h,0,a.order.splice(h+1,1)[0]),a.order[h+1]!=k););}this.resitAll(a);k=a.order.slice(0);n=d.findIndex(function(a){return a.order.join()==k.join()});if(0<=n)break;d.push({order:k,holes:a.holes.length,height:this.maxSpacesV(0,this.columns,a),chaos:this.chaos(a)})}d.splice(0,n);d.sort(function(a,b){return a.holes!=b.holes?a.holes-b.holes:a.height!=b.height?a.height-b.height:a.chaos-b.chaos});this.debug&&console.log({iteration:b,time:performance.now()-e,floortiles:this});
0<d.length&&(a.order=d[0].order,this.resitAll(a));this.result(a)};k.prototype.result=function(b){for(var a=this.$element.find(".floortiles-wrapper"),f=a.children(),d=this.step(),e,c,h,g=0;g<b.tiles.length;g++)h=b.poses[g],e=this.boundSize(b.tiles[g]),c=this.boundSizeR(e),h={x:d.x*h.x,y:d.y*h.v},c={x:d.x*c.x-this.gap,y:d.y*c.v-this.gap},this.tiled(f.eq(g),{index:g,tile:e,pos:h,size:c,tileSize:this.tileSize}),this.animate&&this.nextStatus?f.eq(g).animate({width:c.x+"px",height:c.y+"px",left:h.x+"px",
top:h.y+"px"},this.animateTime):f.eq(g).css({width:c.x+"px",height:c.y+"px",left:h.x+"px",top:h.y+"px"});a.css({width:d.x*this.columns-this.gap+"px",height:d.y*this.maxSpacesV(0,this.columns,b)-this.gap+"px"})};k.prototype.sitAll=function(b){for(var a=0;a<this.columns;a++)b.spaces[a]={y:0,v:0};for(a=0;a<b.order.length;a++)b.poses[b.order[a]]=this.sit(b.tiles[b.order[a]],b,b.order[a])};k.prototype.resitAll=function(b){b.spaces.length=0;b.holes.length=0;this.sitAll(b)};k.prototype.sit=function(b,a,
f){b=this.boundSize(b);if(b.x>=this.columns){b=this.boundSizeR(b);var d={x:0,y:this.maxSpaces(0,this.columns,a),v:this.maxSpacesV(0,this.columns,a)};for(var e=0;e<this.columns;e++){for(var c=a.spaces[e].y;c<d.y;c++)a.holes.push({x:e,y:c,v:c-a.spaces[e].y+a.spaces[e].v,i:f});a.spaces[e]={y:d.y+b.y,v:d.v+b.v}}a.holes.sort(this.compareH);return d}b=this.boundSizeR(b);for(var h=[],e=0;e<this.columns-b.x+1;e++)h[e]={x:e,y:this.maxSpaces(e,e+b.x,a),v:this.maxSpacesV(e,e+b.x,a)};h.sort(this.compareH);for(var g=
[],e=0;e<a.holes.length;e++){d=a.holes[e];for(c=1;c<b.x&&(!(e+c>=a.holes.length||a.holes[e+c].x!=d.x+c||a.holes[e+c].y!=d.y)||!(a.holes[e].x+c>=this.columns||a.spaces[a.holes[e].x+c].y>d.y));c++);c==b.x&&g.push(d)}var k=g.length;if(0<k&&1<b.y){g.sort(this.compareV);for(e=0;e<k-b.y+1;e++){d=g[e];for(c=1;c<b.y&&g[e+c].x==d.x&&g[e+c].y==d.y+c;c++);c==b.y&&g.push(d)}g.splice(0,k);g.sort(this.compareH)}if(0<g.length&&0>this.compareH(g[0],h[0])){d={x:g[0].x,y:g[0].y,v:g[0].v};for(e=0;e<a.holes.length&&
(a.holes[e].x!=d.x||a.holes[e].y!=d.y);e++);for(c=1;c<b.x&&e+c<a.holes.length&&a.holes[e+c].x==d.x+c&&a.holes[e+c].y==d.y;c++);for(a.holes.splice(e,c);c<b.x;c++){for(h=a.spaces[d.x+c].y;h<d.y;h++)a.holes.push({x:d.x+c,y:h,v:h-a.spaces[d.x+c].y+a.spaces[d.x+c].v,i:f});a.spaces[d.x+c]={x:d.x+c,y:d.y+b.y,v:d.v+b.v}}for(h=1;h<b.y;h++){for(;e<a.holes.length&&(a.holes[e].x!=d.x||a.holes[e].y!=d.y+h);e++);for(c=1;c<b.x&&e+c<a.holes.length&&a.holes[e+c].x==d.x+c&&a.holes[e+c].y==d.y+h;c++);a.holes.splice(e,
c)}a.holes.sort(this.compareH);return d}d={x:h[0].x,y:h[0].y,v:h[0].v};for(e=d.x;e<d.x+b.x;e++){for(c=a.spaces[e].y;c<d.y;c++)a.holes.push({x:e,y:c,v:c+a.spaces[e].v-a.spaces[e].y,i:f});a.spaces[e]={y:d.y+b.y,v:d.v+b.v}}a.holes.sort(this.compareH);h.length=0;return d};k.prototype.compareH=function(b,a){return b.y!=a.y?b.y-a.y:b.x-a.x};k.prototype.compareV=function(b,a){return b.x!=a.x?b.x-a.x:b.y-a.y};k.prototype.step=function(){var b=Math.min(Math.round((this.width+this.gap)/this.columns-this.gap),
this.tileSize.x);return{x:b+this.gap,y:Math.round(b/this.tileSize.x*this.tileSize.y)+this.gap}};k.prototype.size=function(b){b=b.split("x");return 2!=b.length?!1:{x:parseInt(b[0]),y:parseInt(b[1])}};k.prototype.minSize=function(b,a){var f=this.size(b);if(!f)return!1;var d=this.size(a);return{x:Math.max(f.x,d.x),y:Math.max(f.y,d.y)}};k.prototype.minSizeTile=function(b){return(b=this.minSize(b,"1x1"))?b:{x:1,y:1}};k.prototype.boundSize=function(b){return{x:Math.min(b.x,this.tileLimit.x),y:Math.min(b.y,
this.tileLimit.y)}};k.prototype.boundSizeR=function(b){return b.x>this.columns?{x:this.columns,y:1,v:b.y/b.x*this.columns}:b.x==this.columns?{x:this.columns,y:1,v:b.y}:{x:b.x,y:b.y,v:b.y}};k.prototype.maxSpaces=function(b,a,f){var d=f.spaces[b].y;for(b+=1;b<a;b++)d=Math.max(d,f.spaces[b].y);return d};k.prototype.maxSpacesV=function(b,a,f){var d=f.spaces[b].v;for(b+=1;b<a;b++)d=Math.max(d,f.spaces[b].v);return d};k.prototype.chaos=function(b){for(var a=0,f=0;a<b.order.length;a++)f+=Math.abs(a-b.order[a]);
return f};var p={init:function(b){return this.each(function(){var a=m(this),f=a.data("floortiles"),d;f?f.reset(b):(f=new k(this,b),m(window).on("resize.floortiles",function(){d&&clearTimeout(d);d=setTimeout(function(){f.refresh()},f.delayResizeTime)}));a.data("floortiles",f)})},refresh:function(){return this.each(function(){m(this).data("floortiles").refresh()})},destroy:function(){return this.each(function(){m(window).off(".floortiles");m(this).data("floortiles").destructor();m(this).removeData("floortiles")})}};
m.fn.floortiles=function(b){if(p[b])return p[b].apply(this,Array.prototype.slice.call(arguments,1));if("object"!==typeof b&&b)m.error("The method named "+b+" does not exist in jQuery.floortiles");else return p.init.apply(this,arguments)}})(jQuery);